---
import { Image } from 'astro:assets';
import type { Project } from '../pages/projects/projects'
import { kFormatter } from '../utils'
// import GithubWhite from '@src/assets/img/github-mark-white.svg';
// import GithubBlack from '@src/assets/img/github-mark.svg';

const { projects } = Astro.props

---
<div class="flex flex-col gap-5">
  {
    projects.map((project: Project, index: number) => 
      <div class="border dark:border-zinc-700 rounded-xl shadow-sm p-5 relative bg-white dark:bg-zinc-900/70 transition-all duration-[220ms] hover:-translate-y-1 hover:shadow-xl hover:border-zinc-400 dark:hover:border-zinc-500">
        <div class="flex flex-col md:flex-row gap-6">
          {project.image && (
            <div class="project-cover mx-auto md:mx-0 mb-4 md:mb-0 w-full md:w-48 shrink-0">
              {typeof project.image === 'string' ? (
                <img src={project.image} alt={project.imageAlt || project.name} loading="lazy" class="rounded w-full h-48 object-cover" />
              ) : (
                <Image src={project.image} alt={project.imageAlt || project.name} width={220} height={260} class="rounded w-full object-cover" loading="lazy" />
              )}
            </div>
          )}
          <div class="flex-1 flex flex-col">
            <h3 class="font-semibold mb-2">
              <a class="hover:underline" href={project.demoLink} target="_blank" rel={project.demoLinkRel}>{project.name}</a>
            </h3>
            <div class="text-zinc-600 dark:text-zinc-300 mb-4 description-container text-sm flex-grow">
              <p class="description-text line-clamp-2 min-h-[60px] max-h-[60px]" id={`project-description-${index}`}>{project.description}</p>
              <p class="description-text-full hidden" id={`project-description-full-${index}`}>{project.description}</p>
              {project.description && project.description.length > 100 && (
                <button 
                  id={`project-read-more-${index}`} 
                  class="text-sm font-bold text-zinc-600 dark:text-zinc-300 hover:underline mt-1 project-read-more-btn"
                  onclick={`toggleProjectDescription(${index})`}
                >
                  Read more
                </button>
              )}
            </div>
            <div class="flex justify-end gap-3 mt-auto">
          {
            project.postLink &&
            <a 
              class="border border-zinc-300 dark:border-zinc-700 rounded-2xl
                text-sm text-zinc-700 dark:text-zinc-300 no-underline px-3 py-1
                transition-all duration-[220ms] flex items-center gap-1
                hover:border-zinc-700 dark:hover:border-zinc-300"
              href={project.postLink}
            >
              Article
            </a>
          }
          {
            project.paperLink &&
            <a 
              class="border border-zinc-300 dark:border-zinc-700 rounded-2xl
                text-sm text-zinc-700 dark:text-zinc-300 no-underline px-3 py-1
                transition-all duration-[220ms] flex items-center gap-1
                hover:border-zinc-700 dark:hover:border-zinc-300"
              href={project.paperLink}
              target="_blank" 
              rel="noopener"
            >
              Paper
            </a>
          }
          {
            project.demoLink &&
            <a 
              class="border border-zinc-300 dark:border-zinc-700 rounded-2xl
                text-sm text-zinc-700 dark:text-zinc-300 no-underline px-3 py-1
                transition-all duration-[220ms] flex items-center gap-1
                hover:border-zinc-700 dark:hover:border-zinc-300"
              href={project.demoLink} 
              target="_blank" 
              rel={project.demoLinkRel}
            >
              Demo
            </a>
          }
            </div>
          </div>
        </div>
      </div>
    )
  }
</div>

<!-- Read More and Show Less Button Functionality -->
<script>
  function toggleProjectDescription(index: number) {
    const descriptionEl = document.getElementById(`project-description-${index}`);
    const descriptionFullEl = document.getElementById(`project-description-full-${index}`);
    const buttonEl = document.getElementById(`project-read-more-${index}`);
    
    if (!descriptionEl || !descriptionFullEl || !buttonEl) return;
    
    if (descriptionEl.classList.contains('line-clamp-2')) {
      // Expand
      descriptionEl.classList.remove('line-clamp-2');
      descriptionEl.classList.add('hidden');
      descriptionFullEl.classList.remove('hidden');
      buttonEl.textContent = 'Show less';
    } else {
      // Collapse
      descriptionEl.classList.add('line-clamp-2');
      descriptionEl.classList.remove('hidden');
      descriptionFullEl.classList.add('hidden');
      buttonEl.textContent = 'Read more';
    }
  }

  // Initialize all buttons
  document.addEventListener('DOMContentLoaded', () => {
    const buttons = document.querySelectorAll('.project-read-more-btn');
    buttons.forEach(btn => {
      btn.addEventListener('click', (e) => {
        const target = e.target as HTMLElement;
        const parts = target.id.split('-');
        const index = parseInt(parts[parts.length - 1], 10);
        toggleProjectDescription(index);
      });
    });
  });
</script>
